# SQL Injection Attack

## Introduction

- SQL Injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database.

- It generally allows an attacker to view data that they are not normally able to retrieve.

- It is a technique used to take advantage of un-sanitized input vulnerabilities to pass SQL commands through a web application for execution by a backend database.

## Why bother about SQL Injection?

- It is one of the most common web hacking techniques.

- SQL Injection can lead to :

  - Information Disclosure

  - Data Loss

  - Data Manipulation

  - Elevation of Privileges

  - Denial of Service

  - Authentication Bypass

  - Compromising the Server

  - Remote Code Execution

## Types of SQL Injection

### In-band SQLi (Classic SQLi)

- The attacker use the same communication channel to perform attack and retrieve the results.

- Its further classified into many types:

  - Error-based SQLi :

    - Attackers intentionally insert bad queries into an app, thereby causing error messages to be generated by the database server.

  - System Stored Procedure :

    - Attackers exploit databases' stored procedures to perform malicious activities.

  - Illegal/Logically Incorrect Query :

    - Attackers use illegal or logically incorrect queries to exploit the database.

  - Union Query :

    - Attackers use the UNION operator to combine the results of two or more SELECT statements into a single result which can then be returned as part of the HTTP response.

  - Tautology :

    - Attacker inject statements that are always true so that queries always return results after evaluating the where condition

    - `SELECT * FROM users WHERE username = '' OR '1'='1' AND password = '' OR '1'='1'`

  - End Of Line Comment :

    - After injecting the code into a specific field, legitimate code that follows is nullified by commenting it out.

    - `SELECT * FROM users WHERE username = '' OR '1'='1' -- AND password = '' OR '1'='1'`

  - In-line Comments :

    - Attackers integrate multiple vulnerable inputs into a single query using inline comments

    - `SELECT * FROM users WHERE username = '' OR '1'='1' /*' AND password = '' OR '1'='1'*/`

  - Piggybacked query :

    - Attackers inject additional malicious queries into the original query.
    - Consequently, the DBMS executes both the queries.
    - `SELECT * FROM users; DROP TABLE suppliers`

### Error-based SQLi

- Error-based SQLi is an in-band SQL Injection technique that relies on error messages thrown by the database server to obtain information about the structure of the database.

- This exploit may differ according to the database.

- Consider the following SQL query:

  - `SELECT * from products WHERE id_product=$id_product`

- Consider the following request to a script that executes the query above :

  - `http://www.example.com/product.php?id=10`

- The malicious request will look like this :

  - `http://www.example.com/product.php?id=10 || UTL_INADDR.GET_HOST_NAME((SELECT user FROM DUAL)) --`

### Union-based SQLi

- This technique involves joining a forged query with the original query using the UNION SQL operator.

- The result of the forged query will be joined to the original query, thereby allowing it to obtain the values of fields of other tables.

- Consider the following SQL query:

  - `SELECT name, description FROM products WHERE id_product=$id_product`

- Now set the following id value :

  - `$id_product=1 UNION ALL SELECT creditcardnumber, 1, 1 FROM creditCardTable`

- Final query is as shown below :

  - `SELECT name, description FROM products WHERE id_product=1 UNION ALL SELECT creditcardnumber, 1, 1 FROM creditCardTable`

- The above query joins the results of the original query with all credit card users.

### Blind / Inferential SQLi

- Blind SQL Injection is an inferential SQL Injection technique that relies on sending SQL queries to the database which forces the application to return a different result depending on whether the query returns a TRUE or FALSE result.

- Blind SQLi is used when the web app is vulnerable to an SQLi, but the results of the injection are not visible to the attacker.

- It is identical to normal SQLi, except that a generic custom page is displayed when an attacker attempts to exploit an app rather than seeing a useful error message.

- This type of attack can become time-intensive because a new statement must be crafted for each bit recovered.

- There is no error message returned when the attack is successful.

- Since there is no error message, we can use waitfor delay command to check the sql injection status.

- WAIT FOR DELAY 'time'(seconds) : It is just like sleep for specific time.

- So if the attack is successful then the page will take more time to load.

- Boolean Exploitation :

  - Multiple valid statements that evaluate to true and false are supplied in the affected parameters in the HTTP request
  - By comparing the response page between both conditions, the attacker can infer whether the injection was successful or not.

### Out-of-band SQLi

- Out-of-band SQL Injection is not very common, mostly because it depends on features being enabled on the database server being used by the web application.

- The attacker needs to communicate with the server and acquire features of the databse server used by the web application

- Attacker use different communication channels to perform the attack and obtain the result.

- Attakers use DNS and HTTP requests to retrieve data from database server.

- For example, in MS SQL server, an attacker exploits the xp_dirtree command to send DNS requests to a server they control.

## SQL injection tools

- [SQLMap]()
- [Mole]()
- [SQL Power Injector]()
- [SQL Ninja]()
- [NoSQLMap]()